{"version":3,"sources":["../scripts/routing.js"],"names":["window","friendlyPix","Router","constructor","$","document","ready","auth","waitForAuth","then","pagesElements","splashLogin","location","pathname","page","pipe","displayPage","bind","loadUser","userId","userPage","showHomeFeed","feed","showGeneralFeed","clearFeed","clear","showPost","postId","post","loadPost","pageId","onlyAuthed","attributes","context","firebase","currentUser","show","setLinkAsActive","canonicalPath","each","index","element","id","fadeOut","hide","MaterialUtils","closeDrawer","scrollToTop","reloadPage","path","animate","scrollTop","funct","attribute","optContinue","next","params","Object","keys","length","removeClass","addClass","router"],"mappings":"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","file":"routing.js","sourcesContent":["/**\n * Copyright 2016 Abhinav Thomas. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the pages/routing.\n */\nfriendlyPix.Router = class {\n\n  /**\n   * Initializes the Friendly Pix controller/router.\n   * @constructor\n   */\n  constructor() {\n    $(document).ready(() => {\n      friendlyPix.auth.waitForAuth.then(() => {\n        // Dom elements.\n        this.pagesElements = $('[id^=page-]');\n        this.splashLogin = $('#login', '#page-splash');\n\n        // Make sure /add is never opened on website load.\n        if (window.location.pathname === '/add') {\n          page('/');\n        }\n\n        // Configuring routes.\n        const pipe = friendlyPix.Router.pipe;\n        const displayPage = this.displayPage.bind(this);\n        const loadUser = userId => friendlyPix.userPage.loadUser(userId);\n        const showHomeFeed = () => friendlyPix.feed.showHomeFeed();\n        const showGeneralFeed = () => friendlyPix.feed.showGeneralFeed();\n        const clearFeed = () => friendlyPix.feed.clear();\n        const showPost = postId => friendlyPix.post.loadPost(postId);\n        \n        page('/', pipe(showHomeFeed, null, true),\n            pipe(displayPage, {pageId: 'feed', onlyAuthed: true}));\n        page('/feed', pipe(showGeneralFeed, null, true), pipe(displayPage, {pageId: 'feed', onlyAuthed: true}));\n        page('/post/:postId', pipe(showPost, null, true), pipe(displayPage, {pageId: 'post', onlyAuthed: true}));\n        page('/user/:userId', pipe(loadUser, null, true), pipe(displayPage, {pageId: 'user-info', onlyAuthed: true}));\n        page('/about', pipe(clearFeed, null, true), pipe(displayPage, {pageId: 'about'}));\n        page('/add', pipe(displayPage, {pageId: 'add', onlyAuthed: true}));\n        page('*', () => page('/'));\n\n        // Start routing.\n        page();\n      });\n    });\n  }\n\n  /**\n   * Returns a function that displays the given page and hides the other ones.\n   * if `onlyAuthed` is set to true then the splash page will be displayed instead of the page if\n   * the user is not signed-in.\n   */\n\n  displayPage(attributes, context) {\n    const onlyAuthed = attributes.onlyAuthed;\n    let pageId = attributes.pageId;\n\n    if (onlyAuthed && !firebase.auth().currentUser) {\n      pageId = 'splash';\n      this.splashLogin.show();\n    }\n    friendlyPix.Router.setLinkAsActive(context.canonicalPath);\n    this.pagesElements.each(function(index, element) {\n      if (element.id === 'page-' + pageId) {\n        $(element).show();\n      } else if (element.id === 'page-splash') {\n        $(element).fadeOut(1000);\n      } else {\n        $(element).hide();\n      }\n    });\n    friendlyPix.MaterialUtils.closeDrawer();\n    friendlyPix.Router.scrollToTop();\n  }\n\n  /**\n   * Reloads the current page.\n   */\n  reloadPage() {\n    let path = window.location.pathname;\n    if (path === '') {\n      path = '/';\n    }\n    page(path);\n  }\n\n  /**\n   * Scrolls the page to top.\n   */\n  static scrollToTop() {\n    $('html,body').animate({scrollTop: 0}, 0);\n  }\n\n  /**\n   * Pipes the given function and passes the given attribute and Page.js context.\n   * Set 'optContinue' to true if there are further functions to call.\n   */\n  static pipe(funct, attribute, optContinue) {\n    return (context, next) => {\n      if (funct) {\n        const params = Object.keys(context.params);\n        if (!attribute && params.length > 0) {\n          funct(context.params[params[0]], context);\n        } else {\n          funct(attribute, context);\n        }\n      }\n      if (optContinue) {\n        next();\n      }\n    };\n  }\n\n  /**\n   * Highlights the correct menu item/link.\n   */\n  static setLinkAsActive(canonicalPath) {\n    if (canonicalPath === '') {\n      canonicalPath = '/';\n    }\n    $('.is-active').removeClass('is-active');\n    $(`[href=\"${canonicalPath}\"]`).addClass('is-active');\n  }\n};\n\nfriendlyPix.router = new friendlyPix.Router();\n"]}