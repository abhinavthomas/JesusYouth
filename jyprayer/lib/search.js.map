{"version":3,"sources":["../scripts/search.js"],"names":["window","friendlyPix","Search","MIN_CHARACTERS","NB_RESULTS_LIMIT","constructor","database","firebase","$","document","ready","searchField","searchResults","keyup","displaySearchResults","focus","click","searchString","val","toLowerCase","trim","length","searchUsers","then","results","empty","peopleIds","Object","keys","fadeIn","unbind","fadeOut","forEach","peopleId","profile","append","createSearchResultHtml","peopleProfile","profile_picture","full_name","search"],"mappings":"AAAA;;;;;;;;;;;;;;GAeA,aAEAA,OAAOC,WAAP,CAAqBD,OAAOC,WAAP,EAAsB,EAA3C,CAEA;;GAGAA,YAAYC,MAAZ,CAAqB,KAAM,CAEzB;;;KAIA,UAAWC,eAAX,EAA4B,CAC1B,MAAO,EACR,CAED;;;KAIA,UAAWC,iBAAX,EAA8B,CAC5B,MAAO,GACR,CAED;;KAGAC,aAAc,CACZ;AACA,KAAKC,QAAL,CAAgBC,SAASD,QAAT,EAAhB,CAEAE,EAAEC,QAAF,EAAYC,KAAZ,CAAkB,IAAM,CACtB;AACA,KAAKC,WAAL,CAAmBH,EAAE,cAAF,CAAnB,CACA,KAAKI,aAAL,CAAqBJ,EAAE,mBAAF,CAArB,CAEA;AACA,KAAKG,WAAL,CAAiBE,KAAjB,CAAuB,IAAM,KAAKC,oBAAL,EAA7B,EACA,KAAKH,WAAL,CAAiBI,KAAjB,CAAuB,IAAM,KAAKD,oBAAL,EAA7B,EACA,KAAKH,WAAL,CAAiBK,KAAjB,CAAuB,IAAM,KAAKF,oBAAL,EAA7B,CACD,CATD,CAUD,CAED;;KAGAA,sBAAuB,CACrB,KAAMG,cAAe,KAAKN,WAAL,CAAiBO,GAAjB,GAAuBC,WAAvB,GAAqCC,IAArC,EAArB,CACA,GAAIH,aAAaI,MAAb,EAAuBpB,YAAYC,MAAZ,CAAmBC,cAA9C,CAA8D,CAC5DF,YAAYM,QAAZ,CAAqBe,WAArB,CAAiCL,YAAjC,CAA+ChB,YAAYC,MAAZ,CAAmBE,gBAAlE,EAAoFmB,IAApF,CACIC,SAAW,CACT,KAAKZ,aAAL,CAAmBa,KAAnB,GACA,KAAMC,WAAYC,OAAOC,IAAP,CAAYJ,OAAZ,CAAlB,CACA,GAAIE,UAAUL,MAAV,CAAmB,CAAvB,CAA0B,CACxB,KAAKT,aAAL,CAAmBiB,MAAnB,GACArB,EAAE,MAAF,EAAUQ,KAAV,CAAgB,IAAM,CACpBR,EAAE,MAAF,EAAUsB,MAAV,CAAiB,OAAjB,EACA,KAAKlB,aAAL,CAAmBmB,OAAnB,EACD,CAHD,EAIAL,UAAUM,OAAV,CAAkBC,UAAY,CAC5B,KAAMC,SAAUV,QAAQS,QAAR,CAAhB,CACA,KAAKrB,aAAL,CAAmBuB,MAAnB,CACIlC,YAAYC,MAAZ,CAAmBkC,sBAAnB,CAA0CH,QAA1C,CAAoDC,OAApD,CADJ,CAED,CAJD,CAKD,CAXD,IAWO,CACL,KAAKtB,aAAL,CAAmBmB,OAAnB,EACD,CACF,CAlBL,CAmBD,CApBD,IAoBO,CACL,KAAKnB,aAAL,CAAmBa,KAAnB,GACA,KAAKb,aAAL,CAAmBmB,OAAnB,EACD,CACF,CAED;;KAGA,MAAOK,uBAAP,CAA8BH,QAA9B,CAAwCI,aAAxC,CAAuD,CACrD,MAAQ;8FACkFJ,QAAS;iEACtCI,cAAcC,eAAd,EACjD,wBAAyB;6DACoBD,cAAcE,SAAU;aAElF,CA9EwB,CAA3B,CAiFAtC,YAAYuC,MAAZ,CAAqB,GAAIvC,aAAYC,MAArC","file":"search.js","sourcesContent":["/**\n * Copyright 2016 Abhinav Thomas. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the Friendly Pix search feature.\n */\nfriendlyPix.Search = class {\n\n  /**\n   * The minimum number of characters to trigger a search.\n   * @return {number}\n   */\n  static get MIN_CHARACTERS() {\n    return 3;\n  }\n\n  /**\n   * The maximum number of search results to be displayed.\n   * @return {number}\n   */\n  static get NB_RESULTS_LIMIT() {\n    return 10;\n  }\n\n  /**\n   * Initializes the Friendly Pix search bar.\n   */\n  constructor() {\n    // Firebase SDK.\n    this.database = firebase.database();\n\n    $(document).ready(() => {\n      // DOM Elements pointers.\n      this.searchField = $('#searchQuery');\n      this.searchResults = $('#fp-searchResults');\n\n      // Event bindings.\n      this.searchField.keyup(() => this.displaySearchResults());\n      this.searchField.focus(() => this.displaySearchResults());\n      this.searchField.click(() => this.displaySearchResults());\n    });\n  }\n\n  /**\n   * Display search results.\n   */\n  displaySearchResults() {\n    const searchString = this.searchField.val().toLowerCase().trim();\n    if (searchString.length >= friendlyPix.Search.MIN_CHARACTERS) {\n      friendlyPix.firebase.searchUsers(searchString, friendlyPix.Search.NB_RESULTS_LIMIT).then(\n          results => {\n            this.searchResults.empty();\n            const peopleIds = Object.keys(results);\n            if (peopleIds.length > 0) {\n              this.searchResults.fadeIn();\n              $('html').click(() => {\n                $('html').unbind('click');\n                this.searchResults.fadeOut();\n              });\n              peopleIds.forEach(peopleId => {\n                const profile = results[peopleId];\n                this.searchResults.append(\n                    friendlyPix.Search.createSearchResultHtml(peopleId, profile));\n              });\n            } else {\n              this.searchResults.fadeOut();\n            }\n          });\n    } else {\n      this.searchResults.empty();\n      this.searchResults.fadeOut();\n    }\n  }\n\n  /**\n   * Returns the HTML for a single search result\n   */\n  static createSearchResultHtml(peopleId, peopleProfile) {\n    return `\n        <a class=\"fp-searchResultItem fp-usernamelink mdl-button mdl-js-button\" href=\"/user/${peopleId}\">\n            <div class=\"fp-avatar\"style=\"background-image: url(${peopleProfile.profile_picture ||\n                '/images/silhouette.jpg'})\"></div>\n            <div class=\"fp-username mdl-color-text--black\">${peopleProfile.full_name}</div>\n        </a>`;\n  }\n};\n\nfriendlyPix.search = new friendlyPix.Search();\n"]}