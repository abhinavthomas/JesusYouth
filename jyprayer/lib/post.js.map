{"version":3,"sources":["../scripts/post.js"],"names":["window","friendlyPix","Post","constructor","timers","database","firebase","storage","auth","$","document","ready","postPage","postElement","createPostHtml","MaterialUtils","upgradeTextFields","toast","theatre","loadPost","postId","getPostData","then","snapshot","post","val","clear","data","message","timeout","MaterialSnackbar","showSnackbar","currentUser","page","uid","fillPostData","key","thumb_url","url","text","author","timestamp","thumb_storage_uri","full_storage_uri","full_url","forEach","timer","clearInterval","cancelAllSubscriptions","displayComments","comments","commentsIds","Object","keys","i","length","prepend","createCommentHtml","displayNextPageButton","nextPage","nextPageButton","show","unbind","prop","click","entries","hide","thumbUrl","imageText","thumbStorageUri","picStorageUri","picUrl","attr","css","profile_picture","full_name","replace","enterTheatreMode","_setupDate","_setupDeleteButton","_setupLikeCountAndStatus","_setupComments","leaveTheatreMode","keydown","e","which","getTimeText","push","setInterval","empty","append","getComments","commentIds","subscribeToComments","commentId","commentData","submit","preventDefault","commentText","addComment","ran","Math","floor","random","swal","title","type","showCancelButton","confirmButtonColor","confirmButtonText","closeOnConfirm","showLoaderOnConfirm","allowEscapeKey","deletePost","catch","error","close","registerToUserLike","isliked","updateLike","registerForLikesCount","nbLikes","postCreationTimestamp","millis","Date","now","ms","secs","mins","hrs","days","timeSinceCreation","timeText"],"mappings":"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","file":"post.js","sourcesContent":["/**\n * Copyright 2016 Abhinav Thomas. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the single post UI.\n */\nfriendlyPix.Post = class {\n  /**\n   * Initializes the single post's UI.\n   * @constructor\n   */\n  constructor() {\n    // List of all times running on the page.\n    this.timers = [];\n\n    // Firebase SDK.\n    this.database = firebase.database();\n    this.storage = firebase.storage();\n    this.auth = firebase.auth();\n\n    $(document).ready(() => {\n      this.postPage = $('#page-post');\n      // Pointers to DOM elements.\n      this.postElement = $(friendlyPix.Post.createPostHtml());\n      friendlyPix.MaterialUtils.upgradeTextFields(this.postElement);\n      this.toast = $('.mdl-js-snackbar');\n      this.theatre = $('.fp-theatre');\n    });\n  }\n\n  /**\n   * Loads the given post's details.\n   */\n  loadPost(postId) {\n    // Load the posts information.\n    friendlyPix.firebase.getPostData(postId).then(snapshot => {\n      const post = snapshot.val();\n      // Clear listeners and previous post data.\n      this.clear();\n      if (!post) {\n        var data = {\n          message: 'This post does not exists.',\n          timeout: 5000\n        };\n        this.toast[0].MaterialSnackbar.showSnackbar(data);\n        if (this.auth.currentUser) {\n          page(`/user/${this.auth.currentUser.uid}`);\n        } else {\n          page(`/feed`);\n        }\n      } else {\n        this.fillPostData(snapshot.key, post.thumb_url || post.url, post.text, post.author,\n            post.timestamp, post.thumb_storage_uri, post.full_storage_uri, post.full_url);\n      }\n    });\n  }\n\n  /**\n   * Clears all listeners and timers in the given element.\n   */\n  clear() {\n    // Stops all timers if any.\n    this.timers.forEach(timer => clearInterval(timer));\n    this.timers = [];\n\n    // Remove Firebase listeners.\n    friendlyPix.firebase.cancelAllSubscriptions();\n  }\n\n  /**\n   * Displays the given list of `comments` in the post.\n   */\n  displayComments(comments) {\n    const commentsIds = Object.keys(comments);\n    for (let i = commentsIds.length - 1; i >= 0; i--) {\n      $('.fp-comments', this.postElement).prepend(\n          friendlyPix.Post.createCommentHtml(comments[commentsIds[i]].author,\n              comments[commentsIds[i]].text));\n    }\n  }\n\n  /**\n   * Shows the \"show more comments\" button and binds it the `nextPage` callback. If `nextPage` is\n   * `null` then the button is hidden.\n   */\n  displayNextPageButton(nextPage) {\n    const nextPageButton = $('.fp-morecomments', this.postElement);\n    if (nextPage) {\n      nextPageButton.show();\n      nextPageButton.unbind('click');\n      nextPageButton.prop('disabled', false);\n      nextPageButton.click(() => nextPage().then(data => {\n        nextPageButton.prop('disabled', true);\n        this.displayComments(data.entries);\n        this.displayNextPageButton(data.nextPage);\n      }));\n    } else {\n      nextPageButton.hide();\n    }\n  }\n\n  /**\n   * Fills the post's Card with the given details.\n   * Also sets all auto updates and listeners on the UI elements of the post.\n   */\n  fillPostData(postId, thumbUrl, imageText, author, timestamp, thumbStorageUri, picStorageUri, picUrl) {\n    const post = this.postElement;\n\n    // Fills element's author profile.\n    $('.fp-usernamelink', post).attr('href', `/user/${author.uid}`);\n    $('.fp-avatar', post).css('background-image',\n        `url(${author.profile_picture || '/images/silhouette.jpg'})`);\n    $('.fp-username', post).text(author.full_name || 'Anonymous');\n\n    // Shows the pic's thumbnail.\n    $('.fp-image', post).css('background-image', `url(\"${thumbUrl.replace(/\"/g, '\\\\\"')}\")`);\n    $('.fp-image', post).unbind('click');\n    $('.fp-image', post).click(() => this.enterTheatreMode(picUrl || thumbUrl));\n\n    this._setupDate(postId, timestamp);\n    this._setupDeleteButton(postId, author, picStorageUri, thumbStorageUri);\n    this._setupLikeCountAndStatus(postId);\n    this._setupComments(postId, author, imageText);\n    return post;\n  }\n\n  /**\n   * Leaves the theatre mode.\n   */\n  leaveTheatreMode() {\n    this.theatre.hide();\n    this.theatre.unbind('click');\n    $(document).unbind('keydown');\n  }\n\n  /**\n   * Leaves the theatre mode.\n   */\n  enterTheatreMode(picUrl) {\n    $('.fp-fullpic', this.theatre).prop('src', picUrl);\n    this.theatre.css('display', 'flex');\n    // Leave theatre mode if click or ESC key down.\n    this.theatre.click(() => this.leaveTheatreMode());\n    $(document).keydown(e => {\n      if (e.which === 27) {\n        this.leaveTheatreMode();\n      }\n    });\n  }\n\n  /**\n   * Shows the publishing date of the post and updates this date live.\n   * @private\n   */\n  _setupDate(postId, timestamp) {\n    const post = this.postElement;\n\n    $('.fp-time', post).attr('href', `/post/${postId}`);\n    $('.fp-time', post).text(friendlyPix.Post.getTimeText(timestamp));\n    // Update the time counter every minutes.\n    this.timers.push(setInterval(\n      () => $('.fp-time', post).text(friendlyPix.Post.getTimeText(timestamp)), 60000));\n  }\n\n  /**\n   * Shows comments and binds actions to the comments form.\n   * @private\n   */\n  _setupComments(postId, author, imageText) {\n    const post = this.postElement;\n\n    // Creates the initial comment with the post's text.\n    $('.fp-first-comment', post).empty();\n    $('.fp-first-comment', post).append(friendlyPix.Post.createCommentHtml(author, imageText));\n\n    // Load first page of comments and listen to new comments.\n    $('.fp-comments', post).empty();\n    friendlyPix.firebase.getComments(postId).then(data => {\n      this.displayComments(data.entries);\n      this.displayNextPageButton(data.nextPage);\n\n      // Display any new comments.\n      const commentIds = Object.keys(data.entries);\n      friendlyPix.firebase.subscribeToComments(postId, (commentId, commentData) => {\n        $('.fp-comments', post).append(\n          friendlyPix.Post.createCommentHtml(commentData.author, commentData.text));\n      }, commentIds ? commentIds[commentIds.length - 1] : 0);\n    });\n\n    if (this.auth.currentUser) {\n      // Bind comments form posting.\n      $('.fp-add-comment', post).submit(e => {\n        e.preventDefault();\n        const commentText = $(`.mdl-textfield__input`, post).val();\n        friendlyPix.firebase.addComment(postId, commentText);\n        $(`.mdl-textfield__input`, post).val('');\n      });\n      const ran = Math.floor(Math.random() * 10000000);\n      $('.mdl-textfield__input', post).attr('id', `${postId}-${ran}-comment`);\n      $('.mdl-textfield__label', post).attr('for', `${postId}-${ran}-comment`);\n      // Show comments form.\n      $('.fp-action', post).css('display', 'flex');\n    }\n  }\n\n  /**\n   * Shows/Hode and binds actions to the Delete button.\n   * @private\n   */\n  _setupDeleteButton(postId, author, picStorageUri, thumbStorageUri) {\n    const post = this.postElement;\n\n    if (this.auth.currentUser && this.auth.currentUser.uid === author.uid && picStorageUri) {\n      $('.fp-delete-post', post).show();\n      $('.fp-delete-post', post).click(() => {\n        swal({\n          title: 'Are you sure?',\n          text: 'You will not be able to recover this post!',\n          type: 'warning',\n          showCancelButton: true,\n          confirmButtonColor: '#DD6B55',\n          confirmButtonText: 'Yes, delete it!',\n          closeOnConfirm: false,\n          showLoaderOnConfirm: true,\n          allowEscapeKey: true\n        }, () => {\n          $('.fp-delete-post', post).prop('disabled', true);\n          friendlyPix.firebase.deletePost(postId, picStorageUri, thumbStorageUri).then(() => {\n            swal({\n              title: 'Deleted!',\n              text: 'Your post has been deleted.',\n              type: 'success',\n              timer: 2000\n            });\n            $('.fp-delete-post', post).prop('disabled', false);\n            page(`/user/${this.auth.currentUser.uid}`);\n          }).catch(error => {\n            swal.close();\n            $('.fp-delete-post', post).prop('disabled', false);\n            const data = {\n              message: `There was an error deleting your post: ${error}`,\n              timeout: 5000\n            };\n            this.toast[0].MaterialSnackbar.showSnackbar(data);\n          });\n        });\n      });\n    } else {\n      $('.fp-delete-post', post).hide();\n    }\n  }\n\n  /**\n   * Starts Likes count listener and on/off like status.\n   * @private\n   */\n  _setupLikeCountAndStatus(postId) {\n    const post = this.postElement;\n\n    if (this.auth.currentUser) {\n      // Listen to like status.\n      friendlyPix.firebase.registerToUserLike(postId, isliked => {\n        if (isliked) {\n          $('.fp-liked', post).show();\n          $('.fp-not-liked', post).hide();\n        } else {\n          $('.fp-liked', post).hide();\n          $('.fp-not-liked', post).show();\n        }\n      });\n\n      // Add event listeners.\n      $('.fp-liked', post).click(() => friendlyPix.firebase.updateLike(postId, false));\n      $('.fp-not-liked', post).click(() => friendlyPix.firebase.updateLike(postId, true));\n    } else {\n      $('.fp-liked', post).hide();\n      $('.fp-not-liked', post).hide();\n      $('.fp-action', post).hide();\n    }\n\n    // Listen to number of Likes.\n    friendlyPix.firebase.registerForLikesCount(postId, nbLikes => {\n      if (nbLikes > 0) {\n        $('.fp-likes', post).show();\n        $('.fp-likes', post).text(nbLikes + ' like' + (nbLikes === 1 ? '' : 's'));\n      } else {\n        $('.fp-likes', post).hide();\n      }\n    });\n\n  }\n\n    \n  /**\n   * Returns the HTML for a post's comment.\n   */\n  static createPostHtml() {\n    return `\n        <div class=\"fp-post mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet\n                    mdl-cell--8-col-desktop mdl-grid mdl-grid--no-spacing\">\n          <div class=\"mdl-card mdl-shadow--2dp mdl-cell\n                        mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop\">\n            <div class=\"fp-header\">\n              <a class=\"fp-usernamelink mdl-button mdl-js-button\" href=\"/user/\">\n                <div class=\"fp-avatar\"></div>\n                <div class=\"fp-username mdl-color-text--black\"></div>\n              </a>\n              <!-- Delete button -->\n              <button class=\"fp-delete-post mdl-button mdl-js-button\">\n                Delete\n              </button>\n              <a href=\"/post/\" class=\"fp-time\">now</a>\n            </div>\n            <div class=\"fp-image\"></div>\n            <div class=\"fp-likes\">0 likes</div>\n            <div class=\"fp-first-comment\"></div>\n            <div class=\"fp-morecomments\">View more comments...</div>\n            <div class=\"fp-comments\"></div>\n            <div class=\"fp-action\">\n              <span class=\"fp-like\">\n                <div class=\"fp-not-liked material-icons\">favorite_border</div>\n                <div class=\"fp-liked material-icons\">favorite</div>\n              </span>\n              <form class=\"fp-add-comment\" action=\"#\">\n                <div class=\"mdl-textfield mdl-js-textfield\">\n                  <input class=\"mdl-textfield__input\" type=\"text\">\n                  <label class=\"mdl-textfield__label\">Comment...</label>\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>`;\n  }\n\n  /**\n   * Returns the HTML for a post's comment.\n   */\n  static createCommentHtml(author, text) {\n    return `\n        <div class=\"fp-comment\">\n            <a class=\"fp-author\" href=\"/user/${author.uid}\">${author.full_name || 'Anonymous'}</a>:\n            <span class=\"fp-text\">${text}</span>\n        </div>`;\n  }\n\n  /**\n   * Given the time of creation of a post returns how long since the creation of the post in text\n   * format. e.g. 5d, 10h, now...\n   */\n  static getTimeText(postCreationTimestamp) {\n    let millis = Date.now() - postCreationTimestamp;\n    const ms = millis % 1000;\n    millis = (millis - ms) / 1000;\n    const secs = millis % 60;\n    millis = (millis - secs) / 60;\n    const mins = millis % 60;\n    millis = (millis - mins) / 60;\n    const hrs = millis % 24;\n    const days = (millis - hrs) / 24;\n    var timeSinceCreation = [days, hrs, mins, secs, ms];\n\n    let timeText = 'Now';\n    if (timeSinceCreation[0] !== 0) {\n      timeText = timeSinceCreation[0] + 'd';\n    } else if (timeSinceCreation[1] !== 0) {\n      timeText = timeSinceCreation[1] + 'h';\n    } else if (timeSinceCreation[2] !== 0) {\n      timeText = timeSinceCreation[2] + 'm';\n    }\n    return timeText;\n  }\n};\n\nfriendlyPix.post = new friendlyPix.Post();\n\n$(document).ready(() => {\n  // We add the Post element to the single post page.\n  $('.fp-image-container', friendlyPix.post.postPage).append(friendlyPix.post.postElement);\n});\n"]}